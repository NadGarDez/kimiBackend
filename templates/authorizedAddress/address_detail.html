{% extends 'base.html' %}
{% load static %}

{% block title %}
  Registry - Detalle del Monedero: {{ address.address|truncatechars:10 }}...
{% endblock %}

{% block content %}
  <div class="centered-container mx-auto dashboard-content" style="max-width: 800px;">
    
    <div class="d-flex justify-content-between align-items-center mb-4 border-0">
      <h2 class="h3 text-accent mb-0" style="border-bottom: none !important;">Detalle del Monedero: <span class="fw-bold text-light">{{ address.address|truncatechars:10 }}...</span></h2>

      <a href="{% url 'system_address_manager:address_list' %}" class="btn btn-outline-info fw-bold text-uppercase"><i class="bi bi-arrow-left-circle me-2"></i> Volver a la Lista</a>
    </div>

    <hr class="text-accent mt-0 mb-4" />

    <div class="mb-4 welcome-card p-3 d-flex justify-content-between align-items-start">
      <div style="text-align: justify;" class="me-5">
        <p class="mb-1 text-text-dim">
          <strong>Descripción:</strong> {{ address.description|default:"No hay descripción disponible para esta dirección." }}
        </p>
        <p class="mb-0 text-text-dim">
          <strong>ID Interno (PK):</strong> <span class="fw-bold text-light">{{ address.pk }}</span>
        </p>
      </div>

      <div class="text-end" style="min-width: 150px;">
        <span class="text-text-dim d-block mb-0">Fecha de Registro:</span>
        <span class="fw-bold text-status-ok">{{ address.created_at|date:'Y-m-d' }}</span>
      </div>
    </div>

    <div class="card status-card-table p-3">
      <ul class="nav nav-tabs" id="addressTabs" role="tablist">
        
        <li class="nav-item" role="presentation">
          <button class="nav-link active text-accent" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true"><i class="bi bi-info-circle me-1"></i> Información General</button>
        </li>
        
        <li class="nav-item" role="presentation">
          <button class="nav-link text-accent" id="actions-tab" data-bs-toggle="tab" data-bs-target="#actions" type="button" role="tab" aria-controls="actions" aria-selected="false"><i class="bi bi-gear me-1"></i> Acciones y Estado</button>
        </li>

        <li class="nav-item" role="presentation">
          <button class="nav-link text-accent" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="false"><i class="bi bi-clock-history me-1"></i> Historial de Despliegues</button>
        </li>
      </ul>

      <div class="tab-content pt-3" id="addressTabsContent">
        
        <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
          <h4 class="text-text-light mb-3">Dirección EVM Completa</h4>
          
          <div class="p-3 mb-4 bg-dark rounded border border-info">
            <span class="fw-bold font-monospace text-info fs-5 me-3" style="word-break: break-all;">
                {{ address.address }}
            </span>
            <i class="bi bi-files ms-2 text-text-dim copy-icon" style="cursor: pointer;" 
               data-clipboard-text="{{ address.address }}" 
               title="Copiar"></i>
          </div>

          <h4 class="text-text-light mb-3 mt-4">Detalles de Metadatos</h4>
          <p class="text-text-dim" style="text-align: justify;">Datos de creación y última modificación de este registro.</p>
          
          <dl class="row mb-0 detail-list p-3 bg-dark rounded">
            
            <dt class="col-sm-4 text-accent">Fecha de Creación</dt>
            <dd class="col-sm-8 text-light">{{ address.created_at|date:"Y-m-d H:i" }}</dd>

            <dt class="col-sm-4 text-accent">Última Modificación</dt>
            <dd class="col-sm-8 text-light">{{ address.updated_at|date:"Y-m-d H:i" }}</dd>
          </dl>
        </div>

        <div class="tab-pane fade" id="actions" role="tabpanel" aria-labelledby="actions-tab">
          <h4 class="text-text-light mb-3">Control de Permisos</h4>
          <p class="text-text-dim" style="text-align: justify;">Controles para editar, revocar o eliminar la dirección.</p>
          
          <div class="p-3 mb-4 bg-dark rounded border border-warning">
            <dl class="row mb-0">
                <dt class="col-sm-4 text-accent">Estado de Firma:</dt>
                <dd class="col-sm-8">
                    {% if address.is_active %}
                        <span class="badge bg-success fs-6"><i class="bi bi-check-circle-fill me-1"></i> ACTIVA</span>
                    {% else %}
                        <span class="badge bg-danger fs-6"><i class="bi bi-x-circle-fill me-1"></i> INACTIVA / REVOCADA</span>
                    {% endif %}
                </dd>
            </dl>
          </div>

          <h5 class="text-text-light mt-4 mb-3">Acciones Rápidas</h5>
          <div class="d-flex gap-3">
              <a href="{% url 'system_address_manager:address_update' pk=address.pk %}" 
                 class="btn btn-warning fw-bold text-uppercase">
                  <i class="bi bi-pencil-square me-1"></i> Editar Permisos
              </a>
              <a href="{% url 'system_address_manager:address_delete' pk=address.pk %}" 
                 class="btn btn-danger fw-bold text-uppercase">
                  <i class="bi bi-trash me-1"></i> Eliminar Dirección
              </a>
          </div>
        </div>

        <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
          <h4 class="text-text-light mb-3">Contratos Desplegados</h4>
          <p class="text-text-dim" style="text-align: justify;">Esta lista (a implementar) mostraría todas las transacciones de despliegue donde esta dirección se utilizó como la firmante (`from`).</p>
          
          <div class="text-center p-4 border border-info rounded">
              <i class="bi bi-info-circle-fill text-info h4 d-block mb-2"></i>
              <p class="text-text-dim mb-0">Historial de despliegues no disponible aún. Conecta este modelo con tu modelo `DeployedContract` (o `DeployTransaction`) para visualizar el uso.</p>
          </div>
        </div>
        
      </div>
    </div>
  </div>
{% endblock %}